{"version":3,"file":"PositionWrapper.vue_vue_type_script_setup_true_lang-D14-2-mO.mjs","sources":["../../src/composables/useScrollingParent.ts","../../src/components/utils/PositionWrapper.vue"],"sourcesContent":["import { isDefined } from \"@/utils/helpers\";\r\n\r\n/**\r\n * Given an element, returns the element who scrolls it.\r\n */\r\nexport function getScrollingParent(target: HTMLElement): HTMLElement {\r\n    if (target.style.position === \"fixed\" || !target)\r\n        return document.documentElement;\r\n\r\n    let isScrollingParent = false;\r\n    let nextParent = target.parentElement;\r\n\r\n    while (!isScrollingParent && isDefined(nextParent)) {\r\n        if (nextParent === document.documentElement) break;\r\n\r\n        const { overflow, overflowY } = getComputedStyle(nextParent);\r\n        const { scrollHeight, clientHeight } = nextParent; // Both rounded by nature\r\n\r\n        isScrollingParent =\r\n            /(auto|scroll)/.test(`${overflow}${overflowY}`) &&\r\n            scrollHeight > clientHeight;\r\n\r\n        /* ...found it, this one is returned */\r\n        if (isScrollingParent) break;\r\n\r\n        /* ...if not check the next one */\r\n        nextParent = nextParent.parentElement;\r\n    }\r\n\r\n    return nextParent;\r\n}\r\n","<script setup lang=\"ts\">\r\nimport {\r\n    watch,\r\n    computed,\r\n    nextTick,\r\n    onBeforeUnmount,\r\n    ref,\r\n    type Component,\r\n    type PropType,\r\n} from \"vue\";\r\nimport { isClient } from \"@/utils/ssr\";\r\nimport { getScrollingParent, unrefElement } from \"@/composables\";\r\n\r\ntype Position = \"top\" | \"bottom\" | \"left\" | \"right\";\r\n\r\nconst opposites: Record<Position, Position> = {\r\n    top: \"bottom\",\r\n    bottom: \"top\",\r\n    right: \"left\",\r\n    left: \"right\",\r\n};\r\n\r\ntype Point = { x: number; y: number };\r\n\r\ndefineOptions({ inheritAttrs: false });\r\n\r\nconst props = defineProps({\r\n    teleport: {\r\n        type: [Boolean, String, Object],\r\n        required: true,\r\n    },\r\n    trigger: {\r\n        type: Object as PropType<HTMLElement | Component>,\r\n        default: undefined,\r\n    },\r\n    /**\r\n     * Position of the component relative to the trigger\r\n     * @values auto, top, bottom, left, right, top-right, top-left, bottom-left, bottom-right\r\n     */\r\n    position: {\r\n        type: String,\r\n        validator: (value: string) =>\r\n            [\r\n                \"auto\",\r\n                \"top\",\r\n                \"bottom\",\r\n                \"left\",\r\n                \"right\",\r\n                \"top-right\",\r\n                \"top-left\",\r\n                \"bottom-left\",\r\n                \"bottom-right\",\r\n            ].indexOf(value) > -1,\r\n        default: undefined,\r\n    },\r\n    /** Used for calculation position auto */\r\n    defaultPosition: {\r\n        type: String as PropType<Position>,\r\n        validator: (value: string) =>\r\n            [\"top\", \"bottom\", \"left\", \"right\"].indexOf(value) > -1,\r\n        default: \"top\",\r\n    },\r\n    /** disable the position calculation */\r\n    disabled: { type: Boolean, default: false },\r\n    /** update positioning on teleport */\r\n    disablePositioning: { type: Boolean, default: true },\r\n});\r\n\r\nconst emits = defineEmits<{\r\n    (e: \"update:position\", value: string);\r\n}>();\r\n\r\nconst teleportTo = computed(() =>\r\n    typeof props.teleport === \"boolean\" ? \"body\" : props.teleport,\r\n);\r\n\r\nconst teleportDisabled = computed(() =>\r\n    typeof props.teleport === \"boolean\" || !props.teleport\r\n        ? !props.teleport\r\n        : false,\r\n);\r\n\r\nconst contentRef = ref<HTMLElement | Component>();\r\n\r\nfunction setContent<T extends typeof contentRef.value>(el: T): typeof el {\r\n    contentRef.value = el;\r\n\r\n    nextTick(() => {\r\n        // update positioning\r\n        updatePositioning();\r\n        // add handler\r\n        addHandler();\r\n    });\r\n    return el;\r\n}\r\n\r\n// --- Dynamic Positioning Handling Feature ---\r\n\r\nconst initialPosition = props.position;\r\n\r\nconst scrollingParent = ref(undefined);\r\nconst resizeObserver = ref(null);\r\n\r\nif (isClient && window.ResizeObserver) {\r\n    resizeObserver.value = new window.ResizeObserver(updatePositioning);\r\n}\r\n\r\n// on content or disable state change update event listener\r\nwatch(\r\n    () => props.disabled,\r\n    () => {\r\n        if (!props.disabled) addHandler();\r\n        else removeHandler();\r\n    },\r\n    { immediate: true },\r\n);\r\n\r\n// update positioning if props change\r\nwatch(\r\n    [\r\n        () => !!props.trigger,\r\n        () => props.disablePositioning,\r\n        () => props.disabled,\r\n    ],\r\n    () => {\r\n        nextTick(() => updatePositioning());\r\n    },\r\n    { immediate: true },\r\n);\r\n\r\n// remove any event listener on unmount\r\nonBeforeUnmount(() => removeHandler());\r\n\r\n/** add event listener */\r\nfunction addHandler(): void {\r\n    if (isClient && !scrollingParent.value && contentRef.value) {\r\n        // get parent container\r\n        scrollingParent.value = getScrollingParent(unrefElement(contentRef));\r\n        // set event listener\r\n        if (\r\n            scrollingParent.value &&\r\n            scrollingParent.value !== document.documentElement\r\n        ) {\r\n            scrollingParent.value.addEventListener(\r\n                \"scroll\",\r\n                updatePositioning,\r\n                { passive: true },\r\n            );\r\n            if (window.ResizeObserver)\r\n                resizeObserver.value.observe(scrollingParent.value);\r\n        } else {\r\n            document.addEventListener(\"scroll\", updatePositioning, {\r\n                passive: true,\r\n            });\r\n            window.addEventListener(\"resize\", updatePositioning);\r\n        }\r\n    }\r\n}\r\n\r\n/** remove event listener */\r\nfunction removeHandler(): void {\r\n    if (isClient) {\r\n        if (window.ResizeObserver) resizeObserver.value?.disconnect();\r\n        window.removeEventListener(\"resize\", updatePositioning);\r\n        document.removeEventListener(\"scroll\", updatePositioning);\r\n        scrollingParent.value = undefined;\r\n    }\r\n}\r\n\r\n/** Update the best position set teleport positioning */\r\nfunction updatePositioning(): void {\r\n    if (props.disabled) return;\r\n    let position = props.position;\r\n    // update position if auto position is enabled\r\n    if (initialPosition === \"auto\") {\r\n        // calculate best position\r\n        position = getAutoPosition();\r\n        if (position != props.position)\r\n            // two-way bind updated position\r\n            emits(\"update:position\", position);\r\n    }\r\n    // do not set content position if not teleport enabled\r\n    if (!props.teleport) return;\r\n\r\n    const content = unrefElement(contentRef);\r\n    const trigger = unrefElement(props.trigger);\r\n\r\n    // set content position\r\n    if (content && trigger) {\r\n        const rect = trigger.getBoundingClientRect();\r\n        let top = rect.top + window.scrollY;\r\n        let left = rect.left + window.scrollX;\r\n        // define vertical positioning\r\n        if (position.includes(\"bottom\")) {\r\n            top += trigger.clientHeight;\r\n        } else if (position.includes(\"top\")) {\r\n            top -= content.clientHeight;\r\n        }\r\n        // define horizontal positioning\r\n        if (position === \"left\") {\r\n            left -= content.clientWidth;\r\n        } else if (position === \"right\") {\r\n            left += trigger.clientWidth;\r\n        } else if (position.includes(\"-right\")) {\r\n            left += trigger.clientWidth - content.clientWidth;\r\n        }\r\n\r\n        // adjust exact vertical positioning\r\n        if (position === \"top\" || position === \"bottom\") {\r\n            left += trigger.clientWidth / 2; //- content.clientWidth / 2;\r\n        }\r\n        // adjust exact horizontal positioning\r\n        if (position === \"left\" || position === \"right\") {\r\n            top += trigger.clientHeight / 2; // - content.clientHeight / 2;\r\n        }\r\n\r\n        // set style properties\r\n        if (props.disablePositioning) {\r\n            content.style.position = \"relative\";\r\n            content.style.top = `${top}px`;\r\n            content.style.left = `${left}px`;\r\n        } else {\r\n            content.style.position = \"\";\r\n            content.style.top = \"\";\r\n            content.style.left = \"\";\r\n        }\r\n    }\r\n}\r\n\r\n/** calculate best position if auto */\r\nfunction getAutoPosition(): string {\r\n    let bestPosition = props.defaultPosition;\r\n    if (!props.trigger || !contentRef.value) return bestPosition;\r\n    if (!scrollingParent.value) return bestPosition;\r\n\r\n    // get viewport from container\r\n    const viewRect = new DOMRect(\r\n        scrollingParent.value.offsetLeft,\r\n        scrollingParent.value.offsetTop,\r\n        scrollingParent.value.clientWidth,\r\n        scrollingParent.value.clientHeight,\r\n    );\r\n\r\n    const contentRect = unrefElement(contentRef).getBoundingClientRect();\r\n    const triggerRect = unrefElement(props.trigger).getBoundingClientRect();\r\n\r\n    // detect auto position\r\n    const triggerAnchors = anchors(triggerRect);\r\n    const contentAnchors = anchors(contentRect);\r\n    const contentRectAtAnchor = (pos: Position) => {\r\n        const triggerAnchor = triggerAnchors[pos];\r\n        const contentAnchor = contentAnchors[opposites[pos]];\r\n        // Translates contentRect so contentAnchor is on top of triggerAnchor\r\n        // NOTE: this doesn't account for the extra offset that the tooltip arrow provides.\r\n        // That offset should be small, and it's tricky to get it from the CSS.\r\n        return new DOMRect(\r\n            contentRect.x + (triggerAnchor.x - contentAnchor.x),\r\n            contentRect.y + (triggerAnchor.y - contentAnchor.y),\r\n            contentRect.width,\r\n            contentRect.height,\r\n        );\r\n    };\r\n\r\n    const defaultOpposite = opposites[props.defaultPosition];\r\n    const crossPosition =\r\n        props.defaultPosition === \"top\" || props.defaultPosition === \"bottom\"\r\n            ? \"left\"\r\n            : \"top\";\r\n    const crossOpposite = opposites[crossPosition];\r\n    // In descending order of priority\r\n    const positions: Position[] = [\r\n        props.defaultPosition,\r\n        defaultOpposite,\r\n        crossPosition,\r\n        crossOpposite,\r\n    ];\r\n    let maxOverlap = 0;\r\n    for (const position of positions) {\r\n        const overlap = intersectionArea(\r\n            viewRect,\r\n            contentRectAtAnchor(position),\r\n        );\r\n        if (overlap > maxOverlap) {\r\n            maxOverlap = overlap;\r\n            bestPosition = position;\r\n        }\r\n    }\r\n    return bestPosition;\r\n}\r\n\r\n// --- Helper Functions ---\r\n\r\nfunction intersectionArea(a: DOMRect, b: DOMRect): number {\r\n    const left = Math.max(a.left, b.left);\r\n    const right = Math.min(a.right, b.right);\r\n    const top = Math.max(a.top, b.top);\r\n    const bottom = Math.min(a.bottom, b.bottom);\r\n    return Math.max(right - left, 0) * Math.max(bottom - top, 0);\r\n}\r\n\r\n/**\r\n * @param rect the bounding rectangle of the trigger element\r\n * @return the \"anchor points\" (points where the arrow attaches) for each side of the tooltip\r\n */\r\nconst anchors = (rect: DOMRect): Record<Position, Point> => ({\r\n    top: { x: (rect.left + rect.right) * 0.5, y: rect.top },\r\n    bottom: { x: (rect.left + rect.right) * 0.5, y: rect.bottom },\r\n    left: { x: rect.left, y: (rect.top + rect.bottom) * 0.5 },\r\n    right: { x: rect.right, y: (rect.top + rect.bottom) * 0.5 },\r\n});\r\n</script>\r\n\r\n<template>\r\n    <Teleport :to=\"teleportTo\" :disabled=\"teleportDisabled\">\r\n        <template v-if=\"teleportDisabled\">\r\n            <slot :set-content />\r\n        </template>\r\n        <template v-else>\r\n            <div\r\n                v-bind=\"$attrs\"\r\n                :style=\"{ position: 'absolute', left: '0px', top: '0px' }\">\r\n                <slot :set-content />\r\n            </div>\r\n        </template>\r\n    </Teleport>\r\n</template>\r\n"],"names":[],"mappings":"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"}